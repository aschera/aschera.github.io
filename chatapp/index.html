<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    
    <meta name="description" content="chat">
    <meta name="author" content="Christina Bögh">
    

    <title>Innlämning 2</title>

    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src='https://cdn.firebase.com/js/client/2.4.0/firebase.js'></script>
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    
    <script src="script.js"></script>
    <script src="login.js"></script>
    <script src="logout.js"></script>
    <script src="likes.js"></script>
    
    <link href="style.css" rel="stylesheet">

</head>

<body style="max-width:80%; margin-left:20px; margin-right:20px; ">
    <div class="container">
        <div class="page-header">
            
            <div id="greeting">
                <h1>Chatapp</h1>
                <p class="lead">Do you want to talk?</p>
            </div>
            
            
            <div id="logininfo">
                <p> You are logged in as: <strong><span id="loginname"></span></strong> 
                    <br>
                    <span id="logout"><button ID="logoutButton" onclick="forgetData()">Log out</button></span></p>
            </div>
        </div>
        <div class="row" style="background-color:#276d7a; margin:0; border-radius: 4px;">
            <div class="col-md-12" id="logInWindow">
                
                    <!-- saved user select -->
                   <!-- <label for="saved_names" id="loginselect">Log in:</label>
                    <select id="saved_names" onchange="logIn2()">
                       <option class="disabled">Select</option>
                    </select>
                
                    <!-- new user type name -->
                    <label for="username" id="registerfield">Log in:</label>
                    <input id="username" type="text" placeholder="Your username">
                    <button id="OK" onclick="logIn()">Log In</button>
                <br>
                    <label id="savename">
                        <input id="selectsavename" type="checkbox" onclick="saveData()";>
                            Remember me.
                    </label>
            </div><!-- end col -->
            </div> <!-- end row -->
<br>  
        <div class="row" style="background-color:#276d7a; margin:0; border-radius: 4px;">
            <div class="col-md-12" id="textline">
                        <span> 
                            <input id="text" type="text" placeholder="Message">
                            <button id="post">Post</button> 
                        </span>
            </div><!-- end col -->
            <div class="col-md-12" id="chat_text">
                <div id="results"></div>
            </div> <!-- end col -->
        </div> <!-- end row -->
    </div>
    <!-- end container -->


    <script> var myFirebase = new Firebase('https://mein-chat.firebaseio.com/'); </script>

    <script>
        var myFirebase = new Firebase('https://mein-chat.firebaseio.com/');
        var usernameInput = document.querySelector('#username');
        var textInput = document.querySelector('#text');
        var postButton = document.querySelector('#post');
        

        postButton.addEventListener("click", function() {
            var msgUser = usernameInput.value;
            var msgText = textInput.value;
            //var timeStamped = Firebase.ServerValue.TIMESTAMP;
	        var time = Date();
            var timeStamped = time.substring(0, 24); 
            
            myFirebase.push({
                username: msgUser,
                text: msgText,
                theTime:timeStamped
                
            });
            textInput.value = "";
        });
        var startListening = function() {
            myFirebase.on('child_added', function(snapshot) {
                var msg = snapshot.val();

                //name
                var msgUsernameElement = document.createElement("span");
                msgUsernameElement.innerHTML = msg.username;
		        msgUsernameElement.id = 'name';
		
                    var msgTime = document.createElement("span");
                    msgTime.innerHTML = ' wrote at ' + msg.theTime;
                    msgTime.id = 'time';
                    msgUsernameElement.appendChild(msgTime);
                
                    var likeButton = document.createElement("input");
                    likeButton.innerHTML = 0;
                    likeButton.type = "button";
                    likeButton.value = "like";
                    likeButton.addEventListener('click', function(event) {
                        console.log('liked');
                        like(snapshot.key());  // adds the key to the function to push 'like'
                    });
                    msgUsernameElement.appendChild(likeButton);
                
                    var dislikeButton = document.createElement("input");
                    dislikeButton.innerHTML = 'hate';
                    dislikeButton.type = "button";
                    dislikeButton.value = "dislike";
                    likeButton.addEventListener('click', function(event) {
                        console.log('disliked');
                        dislike(snapshot.key());  // adds the key to the function to push 'dislike'
                    });
                    msgUsernameElement.appendChild(dislikeButton);
                
                //message
                var msgTextElement = document.createElement("p");
                msgTextElement.innerHTML = msg.text;
		        msgUsernameElement.id = 'message';
		
                //box t hold the name and message
                var msgElement = document.createElement("div");
                msgElement.appendChild(msgUsernameElement);
                msgElement.appendChild(msgTextElement);

                msgElement.className = "msg";
                let element = document.getElementById("results");
                element.insertBefore(msgElement, element.firstChild);
  
            });
        }

        

    </script>
    
    <script>
        function likePost(event) {
				console.log('liked it');
				var hopperRef = usersRef.child("gracehop");
                    hopperRef.update({
                      "nickname": "Amazing Grace"
                    });
					
				}; // end firebase.
			
    </script>

</body>

</html>
