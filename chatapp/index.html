<!DOCTYPE html>
<html lang="en">
<!-- #729f98 green    #283018 darkgreen     #aa863a orange -->
<!-- 276d7a blue    8fcbd4 lightblue		f4c872 yellow ->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    

    <title>Innl√§mning 2</title>

    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src='https://cdn.firebase.com/js/client/2.4.0/firebase.js'></script>

    <script src="script.js"></script>

    <link href="style.css" rel="stylesheet">

</head>

<body style="max-width:80%; margin-left:20px; margin-right:20px; ">
    <div class="container">

        <div class="page-header">
            <h1>Chatapp</h1>
            <p class="lead">Do you want to talk?</p>
            
            <div id="logininfo">
                <p> You are logged in as: <span id="loginname"></span>. <span id="logout"><button onclick="forgetData()">Log out</button></span></p>
            </div>
            
        </div>

        <div class="row" style="background-color:#276d7a; padding:1em;">
            <div class="col-md-12" id="logInWindow" style="background-color:#8fcbd4; padding:1em; margin:1em;">

                
                    <label for="username">New user:</label>
                    <br>
                    <input id="username" type="text" placeholder="Your username">
                    <button id="OK" onclick="logIn()">Log In</button>

                    <label for="saved_names">Log in:</label>
                    <select id="saved_names">

                    </select>

                    <label id="savename">
                        <input type="checkbox" onclick="saveData()";>
                            Remember me.
                    </label>
                
            </div><!-- end col -->
            </div> <!-- end row -->
            
        <div class="row" style="background-color:#276d7a; padding:1em;">
            
            <div class="col-md-12" id="textline">
                        <span> 
                            <input id="text" type="text" placeholder="Message">
                            <button id="post">Post</button> 
                        </span>
                </div><!-- end col -->
            
            <div class="col-md-12" id="chat_text">

                <div id="results"></div>

            </div> <!-- end col -->

        </div> <!-- end row -->

    </div>
    <!-- end container -->


    <script>
        var myFirebase = new Firebase('https://mein-chat.firebaseio.com/');
    </script>

        <script>
            console.log(new Date().getTime());
         
        var myFirebase = new Firebase('https://mein-chat.firebaseio.com/');
        var usernameInput = document.querySelector('#username');
        var textInput = document.querySelector('#text');
        var postButton = document.querySelector('#post');
        

        postButton.addEventListener("click", function() {
            var msgUser = usernameInput.value;
            var msgText = textInput.value;
            //var timeStamped = Firebase.ServerValue.TIMESTAMP;
	    var time = Date();
            var timeStamped = time.substring(0, 24); 
            
            myFirebase.push({
                username: msgUser,
                text: msgText,
                theTime:timeStamped
                
            });
            textInput.value = "";
        });
        var startListening = function() {
            myFirebase.on('child_added', function(snapshot) {
                var msg = snapshot.val();
                
                
                //name
                var msgUsernameElement = document.createElement("span");
                msgUsernameElement.innerHTML = msg.username;
		msgUsernameElement.id = 'name';
		

			var msgTime = document.createElement("span");
		        msgTime.innerHTML = ' wrote at ' + msg.theTime;
			msgTime.id = 'time';

			msgUsernameElement.appendChild(msgTime);

		
                //message
                var msgTextElement = document.createElement("p");
                msgTextElement.innerHTML = msg.text;
		msgUsernameElement.id = 'message';
		

                //box t hold the name and message
                var msgElement = document.createElement("div");
                msgElement.appendChild(msgUsernameElement);
                msgElement.appendChild(msgTextElement);


                msgElement.className = "msg";
                let element = document.getElementById("results");
                element.insertBefore(msgElement, element.firstChild);
                
                
                
            });
        }

        // Begin listening for data
        startListening();
            
            
        
    </script>

    <script>
 /* ************************ ADD username to localstorage **************************** */
        // Read value from storage, or empty array
        names = JSON.parse(localStorage.getItem('locname') || "[]");

        function saveData() {

            var data = document.getElementById('username').value;

            //unique ID for the user
            let id = data.length + 'id' + Math.floor((Math.random() * 100) + 1) + data;
		
            names.push({
                id: id,
                name: data
            });

            localStorage.setItem('locname', JSON.stringify(names));

            console.log(names);
        };
 /* ************************ log out **************************** */
	 function forgetData() {

            let name = usernameInput.value;
	    localStorage.removeItem(name);
		console.log('the user ' + name + ' has been removed.');
		location.reload();
        };


        /* ************************ ADD items to dropdown list **************************** */

        for (i = 0; i < names.length; i++) {
            let item = document.getElementById('saved_names');
            let option = document.createElement("option");
            option.text = names[i].name;
            item.add(option);
        }
    </script>
    <script>
         /* ************************ Log in **************************** */
        // log in menu changes
        function logIn() {
		let n = document.querySelector('#username').value;
		if(n.length > 1) {
			console.log(document.querySelector('#username'));
			   let loginwindow = document.getElementById('logInWindow');
			    loginwindow.style.display = 'none';
			    
			    console.log('yes');
			    let results = document.getElementById('results');
			    results.style.display = 'block';

			    let inputText = document.getElementById('text');
			    inputText.style.display = 'inline-block';
			    
			    let postButton = document.getElementById('post');
			    postButton.style.display = 'inline-block';
			    
			    let loginInfo = document.getElementById('logininfo');
			    loginInfo.style.display = 'inline-block';
		
			    let logoutbutton = document.getElementById('logout');
			    logoutbutton.style.display = 'inline-block';
			    
			    document.getElementById('loginname').innerText = usernameInput.value;
		}
		else {
			console.log('please enter a username');
			window.alert('please enter a username');
		}

         
};
   
     
    </script>
    

</body>

</html>
